<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<title>Intersection Observer - A11y | Scroll-Driven Animation</title>
		<link rel="stylesheet" href="../styles/common.css" />
		<link rel="stylesheet" href="../styles/demo.css" />
		<style>
			/* A11y: Locked state - stays visible permanently */
			.feature-card.is-locked,
			.stat-card.is-locked {
				opacity: 1;
				transform: none;
				transition: none;
			}

			/* High contrast focus */
			a:focus-visible,
			button:focus-visible {
				outline: 3px solid var(--accent);
				outline-offset: 4px;
			}

			/* Better contrast for text */
			.page-header__desc,
			.feature-card p,
			.stat-card__label {
				color: #b8c5d6;
			}
		</style>
	</head>
	<body class="demo--io demo--a11y">
		<a class="skip-link" href="#main">Skip to content</a>

		<!-- Progress Bar -->
		<div class="progress-bar" aria-hidden="true">
			<div class="progress-bar__fill"></div>
		</div>

		<!-- Header -->
		<header class="page-header container">
			<a href="../index.html" class="page-header__back">â† Back to demos</a>
			<h1 class="page-header__title">Intersection Observer - Accessible</h1>
			<p class="page-header__desc">
				Once elements appear, they stay visible. Respects <code>prefers-reduced-motion</code>.
				<br /><span lang="ko">(í•œ ë²ˆ ë‚˜íƒ€ë‚œ ìš”ì†ŒëŠ” ê³„ì† ë³´ì…ë‹ˆë‹¤. ëª¨ì…˜ ê°ì†Œ ì„¤ì •ì„ ì¡´ì¤‘í•©ë‹ˆë‹¤.)</span>
			</p>
			<span class="tag">unobserve() + A11y</span>
		</header>

		<!-- Main Content -->
		<main id="main">
			<!-- Hero Section -->
			<section class="hero" aria-label="Hero introduction">
				<div class="hero__sticky">
					<div class="hero__frame">
						<div class="hero__layer hero__base">
							<h2>Accessible Animations</h2>
							<p>
								Content stays visible after first reveal.
								<br /><span lang="ko">(ì½˜í…ì¸ ê°€ ì²˜ìŒ ë‚˜íƒ€ë‚œ í›„ ê³„ì† ìœ ì§€ë©ë‹ˆë‹¤.)</span>
							</p>
						</div>
						<div class="hero__layer hero__cover" data-io-hero>
							<h2>Scroll Down</h2>
							<p>
								The cover stays up once revealed.
								<br /><span lang="ko">(ì»¤ë²„ê°€ í•œ ë²ˆ ì˜¬ë¼ê°€ë©´ ìœ ì§€ë©ë‹ˆë‹¤.)</span>
							</p>
						</div>
					</div>
				</div>
			</section>

			<!-- Features Section -->
			<section class="features" aria-label="Accessibility features">
				<div class="container">
					<header class="features__header">
						<h2>A11y Features</h2>
						<p>
							Elements lock in place after appearing.
							<br /><span lang="ko">(ìš”ì†Œê°€ ë‚˜íƒ€ë‚œ í›„ ê³ ì •ë©ë‹ˆë‹¤.)</span>
						</p>
					</header>
					<div class="features__grid">
						<article class="feature-card" data-io-card>
							<div class="feature-card__icon" aria-hidden="true">ğŸ”</div>
							<h3>Lock After Reveal</h3>
							<p>
								Uses <code>unobserve()</code> to stop tracking after first appearance.
								<br /><span lang="ko">(unobserve()ë¡œ ì²« ë“±ì¥ í›„ ì¶”ì  ì¤‘ì§€.)</span>
							</p>
						</article>
						<article class="feature-card" data-io-card>
							<div class="feature-card__icon" aria-hidden="true">ğŸš«</div>
							<h3>No Flickering</h3>
							<p>
								Content won't disappear and reappear on scroll.
								<br /><span lang="ko">(ìŠ¤í¬ë¡¤í•´ë„ ì½˜í…ì¸ ê°€ ì‚¬ë¼ì§€ì§€ ì•ŠìŠµë‹ˆë‹¤.)</span>
							</p>
						</article>
						<article class="feature-card" data-io-card>
							<div class="feature-card__icon" aria-hidden="true">â™¿</div>
							<h3>Motion Safe</h3>
							<p>
								Respects user's motion preferences.
								<br /><span lang="ko">(ì‚¬ìš©ìì˜ ëª¨ì…˜ ì„¤ì •ì„ ì¡´ì¤‘í•©ë‹ˆë‹¤.)</span>
							</p>
						</article>
					</div>
				</div>
			</section>

			<!-- Stats Section -->
			<section class="stats" aria-label="Statistics">
				<div class="container">
					<header class="stats__header">
						<h2>Accessibility Stats</h2>
						<p>
							Stats stay visible once revealed.
							<br /><span lang="ko">(í†µê³„ê°€ ë‚˜íƒ€ë‚œ í›„ ê³„ì† ìœ ì§€ë©ë‹ˆë‹¤.)</span>
						</p>
					</header>
					<div class="stats__grid">
						<div class="stat-card" data-io-stat>
							<div class="stat-card__value">100%</div>
							<div class="stat-card__label">Content Accessible</div>
						</div>
						<div class="stat-card" data-io-stat>
							<div class="stat-card__value">0</div>
							<div class="stat-card__label">Reflow Issues</div>
						</div>
						<div class="stat-card" data-io-stat>
							<div class="stat-card__value">A+</div>
							<div class="stat-card__label">User Experience</div>
						</div>
					</div>
				</div>
			</section>

			<!-- Implementation Info -->
			<section class="impl-info" aria-label="Implementation details">
				<div class="container">
					<div class="impl-info__grid">
						<div class="impl-info__box">
							<h3>A11y Implementation</h3>
							<ul>
								<li>Call <code>observer.unobserve(element)</code> after reveal</li>
								<li>Add <code>.is-locked</code> class to prevent transitions</li>
								<li>Check <code>prefers-reduced-motion</code> before animating</li>
								<li>Use semantic HTML and ARIA landmarks</li>
							</ul>
						</div>
						<div class="impl-info__box">
							<h3>Why Lock Content?</h3>
							<ul>
								<li>Prevents cognitive overload from flickering</li>
								<li>Reduces motion for sensitive users</li>
								<li>Improves screen reader experience</li>
								<li>Saves battery on mobile devices</li>
							</ul>
						</div>
						<div class="impl-info__box">
							<h3>Best Practices</h3>
							<ul>
								<li>Always provide static fallback</li>
								<li>Test with reduced motion enabled</li>
								<li>Ensure content is readable without animations</li>
								<li>Use appropriate color contrast</li>
							</ul>
						</div>
					</div>
				</div>
			</section>
		</main>

		<!-- Footer -->
		<footer class="page-footer">
			<div class="container">
				<p>Scroll-Driven Animation Demo - Accessible Version</p>
			</div>
		</footer>

		<script>
			(function () {
				const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

				// Progress bar
				const progressFill = document.querySelector('.progress-bar__fill');
				function updateProgress() {
					const scrollHeight = document.documentElement.scrollHeight - window.innerHeight;
					const progress = scrollHeight > 0 ? window.scrollY / scrollHeight : 0;
					progressFill.style.transform = `scaleX(${progress})`;
				}
				window.addEventListener('scroll', updateProgress, { passive: true });
				updateProgress();

				// Show all immediately if reduced motion
				if (prefersReducedMotion) {
					document.querySelector('[data-io-hero]').style.transform = 'translateY(-100%)';
					document.querySelectorAll('[data-io-card], [data-io-stat]').forEach(el => {
						el.classList.add('is-visible', 'is-locked');
					});
					return;
				}

				// Hero observer - one-time reveal
				let heroRevealed = false;
				const heroObserver = new IntersectionObserver(
					(entries, observer) => {
						entries.forEach(entry => {
							if (entry.isIntersecting && !heroRevealed) {
								const cover = document.querySelector('[data-io-hero]');
								cover.style.transform = 'translateY(-100%)';
								heroRevealed = true;
								observer.unobserve(entry.target);
							}
						});
					},
					{ threshold: 0.4 }
				);

				const hero = document.querySelector('.hero');
				if (hero) heroObserver.observe(hero);

				// Cards & Stats observer - one-time reveal with lock
				const elementsObserver = new IntersectionObserver(
					(entries, observer) => {
						entries.forEach(entry => {
							if (entry.isIntersecting) {
								entry.target.classList.add('is-visible');
								// Lock after transition completes
								setTimeout(() => {
									entry.target.classList.add('is-locked');
								}, 600);
								observer.unobserve(entry.target);
							}
						});
					},
					{ threshold: 0.3 }
				);

				document.querySelectorAll('[data-io-card], [data-io-stat]').forEach(el => {
					elementsObserver.observe(el);
				});
			})();
		</script>
	</body>
</html>
