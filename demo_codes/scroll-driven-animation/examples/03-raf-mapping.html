<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<title>rAF Scroll Mapping</title>
		<style>
			:root {
				color-scheme: light;
				--bg: #0b0d12;
				--panel: #0f172a;
				--text: #e5e7eb;
				--muted: #94a3b8;
				--accent: #22c55e;
			}
			* {
				box-sizing: border-box;
			}
			body {
				margin: 0;
				font-family: "SUIT", "Pretendard", "Noto Sans KR", system-ui, sans-serif;
				background: radial-gradient(circle at 20% 10%, #1f2937, transparent 50%), var(--bg);
				color: var(--text);
			}
			header {
				padding: 32px 24px 16px;
				max-width: 900px;
				margin: 0 auto;
			}
			a {
				color: var(--accent);
				text-decoration: none;
			}
			a:focus-visible {
				outline: 3px solid var(--accent);
				outline-offset: 3px;
			}
			.skip-link {
				position: absolute;
				left: -999px;
				top: 12px;
				background: #0b0d12;
				color: var(--text);
				padding: 8px 12px;
				border-radius: 8px;
				border: 1px solid rgba(148, 163, 184, 0.4);
			}
			.skip-link:focus,
			.skip-link:focus-visible {
				left: 16px;
				z-index: 10;
			}
			.stage {
				min-height: 180vh;
				display: grid;
				place-items: center;
				padding: 24vh 0;
				gap: 24px;
			}
			.card {
				width: min(680px, 92vw);
				padding: 48px;
				border-radius: 20px;
				background: var(--panel);
				color: #e5e7eb;
				font-weight: 700;
				font-size: clamp(28px, 4vw, 44px);
				box-shadow: 0 30px 80px rgba(15, 23, 42, 0.45);
				transform: scale(0.78);
				transform-origin: 50% 50%;
				will-change: transform, opacity;
				text-align: center;
			}
			.hud {
				position: fixed;
				top: 16px;
				right: 16px;
				padding: 10px 14px;
				border-radius: 999px;
				background: rgba(15, 23, 42, 0.85);
				border: 1px solid rgba(148, 163, 184, 0.35);
				font-size: 13px;
				color: var(--muted);
				letter-spacing: 0.02em;
			}
			.hud strong {
				color: var(--accent);
				font-weight: 700;
			}
			.spacer {
				height: 50vh;
				border: 1px dashed rgba(148, 163, 184, 0.2);
				border-radius: 12px;
				display: grid;
				place-items: center;
				color: var(--muted);
				width: min(680px, 92vw);
			}
			.meta {
				max-width: 900px;
				margin: 0 auto;
				padding: 0 24px 80px;
				color: var(--muted);
			}
			@media (prefers-reduced-motion: reduce) {
				.card {
					transform: none !important;
					opacity: 1 !important;
				}
				.hud {
					display: none;
				}
			}
		</style>
	</head>
	<body>
		<a class="skip-link" href="#content">Skip to content</a>
		<header>
			<a href="../index.html">← Back to list</a>
			<h1>scroll + requestAnimationFrame</h1>
			<p>
				Compute progress and map to scale/opacity.
				<br /><span lang="ko">(진행률을 계산해 크기/투명도에 연결.)</span>
			</p>
		</header>
		<div class="hud" aria-live="polite">
			Progress <strong data-progress>0%</strong>
		</div>
		<main id="content">
			<section class="stage">
				<div class="spacer">Scroll down</div>
				<div class="card" data-raf-card>Scroll drives me</div>
				<div class="spacer">Scroll up</div>
			</section>
			<div class="meta">
				<p>
					Progress (0~1) is calculated as the card moves through the viewport.
					We map it to scale and opacity.
					<br /><span lang="ko">(카드가 뷰포트를 지나는 동안 진행률을 계산해 크기/투명도에 연결.)</span>
				</p>
			</div>
		</main>
		<script>
			const card = document.querySelector("[data-raf-card]");
			const progressEl = document.querySelector("[data-progress]");
			const reduceMotion = window.matchMedia("(prefers-reduced-motion: reduce)").matches;

			if (card && !reduceMotion) {
				let ticking = false;

				const clamp01 = (v) => Math.min(1, Math.max(0, v));

				const update = () => {
					ticking = false;

					const rect = card.getBoundingClientRect();
					const viewportH = window.innerHeight;

					const start = viewportH;
					const end = -rect.height;
					const progress = clamp01((start - rect.top) / (start - end));

					const scale = 0.78 + progress * 0.42;
					const opacity = 0.25 + progress * 0.75;

					card.style.transform = `scale(${scale.toFixed(4)})`;
					card.style.opacity = opacity.toFixed(4);
					if (progressEl) progressEl.textContent = `${Math.round(progress * 100)}%`;
				};

				const onScroll = () => {
					if (ticking) return;
					ticking = true;
					window.requestAnimationFrame(update);
				};

				window.addEventListener("scroll", onScroll, { passive: true });
				window.addEventListener("resize", onScroll);
				update();
			}
		</script>
	</body>
</html>
