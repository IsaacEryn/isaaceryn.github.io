<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<title>rAF + Scroll - Basic | Scroll-Driven Animation</title>
		<link rel="stylesheet" href="../styles/common.css" />
		<link rel="stylesheet" href="../styles/demo.css" />
		<style>
			/* rAF controlled - no CSS transitions */
			.demo--raf .hero__cover,
			.demo--raf .feature-card,
			.demo--raf .stat-card {
				transition: none;
			}
		</style>
	</head>
	<body class="demo--raf demo--basic">
		<a class="skip-link" href="#main">Skip to content</a>

		<!-- Progress Bar -->
		<div class="progress-bar" aria-hidden="true">
			<div class="progress-bar__fill"></div>
		</div>

		<!-- Header -->
		<header class="page-header container">
			<a href="../index.html" class="page-header__back">â† Back to demos</a>
			<h1 class="page-header__title">rAF + Scroll - Basic</h1>
			<p class="page-header__desc">
				Animations driven by <code>requestAnimationFrame</code> and scroll position.
				<br /><span lang="ko">(requestAnimationFrameê³¼ ìŠ¤í¬ë¡¤ ìœ„ì¹˜ë¡œ êµ¬ë™ë˜ëŠ” ì• ë‹ˆë©”ì´ì…˜.)</span>
			</p>
			<span class="tag">requestAnimationFrame</span>
		</header>

		<!-- Main Content -->
		<main id="main">
			<!-- Hero Section -->
			<section class="hero" data-raf-hero>
				<div class="hero__sticky">
					<div class="hero__frame">
						<div class="hero__layer hero__base">
							<h2>Welcome</h2>
							<p>
								JavaScript calculates position on every frame.
								<br /><span lang="ko">(JavaScriptê°€ ë§¤ í”„ë ˆì„ë§ˆë‹¤ ìœ„ì¹˜ë¥¼ ê³„ì‚°í•©ë‹ˆë‹¤.)</span>
							</p>
						</div>
						<div class="hero__layer hero__cover">
							<h2>Scroll Down</h2>
							<p>
								Smooth, frame-by-frame animation.
								<br /><span lang="ko">(ë¶€ë“œëŸ¬ìš´ í”„ë ˆì„ ë‹¨ìœ„ ì• ë‹ˆë©”ì´ì…˜.)</span>
							</p>
						</div>
					</div>
				</div>
			</section>

			<!-- Features Section -->
			<section class="features">
				<div class="container">
					<header class="features__header">
						<h2>Features</h2>
						<p>
							Cards animate based on their position in viewport.
							<br /><span lang="ko">(ì¹´ë“œê°€ ë·°í¬íŠ¸ ë‚´ ìœ„ì¹˜ì— ë”°ë¼ ì• ë‹ˆë©”ì´ì…˜ë©ë‹ˆë‹¤.)</span>
						</p>
					</header>
					<div class="features__grid">
						<article class="feature-card" data-raf-card>
							<div class="feature-card__icon">ğŸ®</div>
							<h3>Full Control</h3>
							<p>
								Complete control over animation timing and easing.
								<br /><span lang="ko">(ì• ë‹ˆë©”ì´ì…˜ íƒ€ì´ë°ê³¼ ì´ì§•ì„ ì™„ì „íˆ ì œì–´.)</span>
							</p>
						</article>
						<article class="feature-card" data-raf-card>
							<div class="feature-card__icon">ğŸ“Š</div>
							<h3>Custom Curves</h3>
							<p>
								Implement any mathematical easing function.
								<br /><span lang="ko">(ì–´ë–¤ ìˆ˜í•™ì  ì´ì§• í•¨ìˆ˜ë„ êµ¬í˜„ ê°€ëŠ¥.)</span>
							</p>
						</article>
						<article class="feature-card" data-raf-card>
							<div class="feature-card__icon">ğŸ”§</div>
							<h3>Debugging</h3>
							<p>
								Easy to debug with console logs and breakpoints.
								<br /><span lang="ko">(ì½˜ì†”ê³¼ ë¸Œë ˆì´í¬í¬ì¸íŠ¸ë¡œ ì‰½ê²Œ ë””ë²„ê¹….)</span>
							</p>
						</article>
					</div>
				</div>
			</section>

			<!-- Stats Section -->
			<section class="stats">
				<div class="container">
					<header class="stats__header">
						<h2>By the Numbers</h2>
						<p>
							Values interpolate smoothly as you scroll.
							<br /><span lang="ko">(ìŠ¤í¬ë¡¤ì— ë”°ë¼ ê°’ì´ ë¶€ë“œëŸ½ê²Œ ë³´ê°„ë©ë‹ˆë‹¤.)</span>
						</p>
					</header>
					<div class="stats__grid">
						<div class="stat-card" data-raf-stat data-value="60">
							<div class="stat-card__value">0</div>
							<div class="stat-card__label">Frames Per Second</div>
						</div>
						<div class="stat-card" data-raf-stat data-value="100">
							<div class="stat-card__value">0%</div>
							<div class="stat-card__label">Browser Support</div>
						</div>
						<div class="stat-card" data-raf-stat data-value="16">
							<div class="stat-card__value">0ms</div>
							<div class="stat-card__label">Frame Budget</div>
						</div>
					</div>
				</div>
			</section>

			<!-- Implementation Info -->
			<section class="impl-info">
				<div class="container">
					<div class="impl-info__grid">
						<div class="impl-info__box">
							<h3>Implementation</h3>
							<ul>
								<li><code>requestAnimationFrame</code> syncs with display refresh</li>
								<li>Calculate progress based on <code>getBoundingClientRect()</code></li>
								<li>Apply transforms directly via JavaScript</li>
								<li>Use <code>will-change</code> for GPU acceleration</li>
							</ul>
						</div>
						<div class="impl-info__box">
							<h3>Browser Support</h3>
							<ul>
								<li>Chrome âœ… (all versions)</li>
								<li>Firefox âœ… (all versions)</li>
								<li>Safari âœ… (all versions)</li>
								<li>Edge âœ… (all versions)</li>
								<li>IE 10+ (with prefix)</li>
							</ul>
						</div>
						<div class="impl-info__box">
							<h3>Performance</h3>
							<ul>
								<li>Runs on main thread (blocks JS)</li>
								<li>~60fps when optimized properly</li>
								<li>Use <code>passive: true</code> for scroll listeners</li>
								<li>Throttle calculations with rAF</li>
							</ul>
						</div>
					</div>
				</div>
			</section>
		</main>

		<!-- Footer -->
		<footer class="page-footer">
			<div class="container">
				<p>Scroll-Driven Animation Demo</p>
			</div>
		</footer>

		<script>
			(function () {
				const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

				const progressFill = document.querySelector('.progress-bar__fill');
				const heroCover = document.querySelector('.hero__cover');
				const heroSection = document.querySelector('[data-raf-hero]');
				const cards = document.querySelectorAll('[data-raf-card]');
				const stats = document.querySelectorAll('[data-raf-stat]');

				// Handle reduced motion - set initial state and only update progress bar
				if (prefersReducedMotion) {
					heroCover.style.transform = 'translateY(-100%)';
					cards.forEach(card => {
						card.style.opacity = '1';
						card.style.transform = 'none';
					});
					stats.forEach(stat => {
						stat.style.opacity = '1';
						stat.style.transform = 'none';
						const value = stat.dataset.value;
						const label = stat.querySelector('.stat-card__label').textContent;
						if (label.includes('fps')) stat.querySelector('.stat-card__value').textContent = value;
						else if (label.includes('%')) stat.querySelector('.stat-card__value').textContent = value + '%';
						else if (label.includes('ms')) stat.querySelector('.stat-card__value').textContent = value + 'ms';
					});
					// Only track progress bar for reduced motion users
					window.addEventListener('scroll', () => {
						const docHeight = document.documentElement.scrollHeight - window.innerHeight;
						const progress = docHeight > 0 ? window.scrollY / docHeight : 0;
						progressFill.style.transform = `scaleX(${progress})`;
					}, { passive: true });
					return;
				}

				let ticking = false;

				// Clamp value between 0 and 1
				const clamp = (val) => Math.min(1, Math.max(0, val));

				// Ease out cubic
				const easeOut = (t) => 1 - Math.pow(1 - t, 3);

				function update() {
					ticking = false;
					const vh = window.innerHeight;
					const scrollY = window.scrollY;
					const docHeight = document.documentElement.scrollHeight - vh;

					// Progress bar
					const scrollProgress = docHeight > 0 ? scrollY / docHeight : 0;
					progressFill.style.transform = `scaleX(${scrollProgress})`;

					// Hero cover
					if (heroSection) {
						const heroRect = heroSection.getBoundingClientRect();
						const heroProgress = clamp(-heroRect.top / (heroRect.height - vh));
						const coverY = easeOut(heroProgress) * -100;
						heroCover.style.transform = `translateY(${coverY}%)`;
					}

					// Feature cards
					cards.forEach((card) => {
						const rect = card.getBoundingClientRect();
						const start = vh * 0.85;
						const end = vh * 0.4;
						const progress = clamp((start - rect.top) / (start - end));
						const eased = easeOut(progress);

						card.style.opacity = eased;
						card.style.transform = `translateY(${(1 - eased) * 60}px)`;
					});

					// Stat cards with counter
					stats.forEach((stat) => {
						const rect = stat.getBoundingClientRect();
						const start = vh * 0.8;
						const end = vh * 0.35;
						const progress = clamp((start - rect.top) / (start - end));
						const eased = easeOut(progress);

						stat.style.opacity = eased;
						stat.style.transform = `scale(${0.9 + eased * 0.1})`;

						// Counter animation
						const target = parseFloat(stat.dataset.value);
						const current = Math.round(target * eased);
						const label = stat.querySelector('.stat-card__label').textContent;
						const valueEl = stat.querySelector('.stat-card__value');

						if (label.includes('fps')) valueEl.textContent = current;
						else if (label.includes('%')) valueEl.textContent = current + '%';
						else if (label.includes('ms')) valueEl.textContent = current + 'ms';
					});
				}

				function onScroll() {
					if (!ticking) {
						ticking = true;
						requestAnimationFrame(update);
					}
				}

				window.addEventListener('scroll', onScroll, { passive: true });
				window.addEventListener('resize', onScroll, { passive: true });
				update();
			})();
		</script>
	</body>
</html>
